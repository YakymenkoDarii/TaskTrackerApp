@page "/boards"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]

<PageTitle>
    Boards
</PageTitle>

<MudContainer MaxWidth=@MaxWidth.Large
              Class="mt-8 mb-16">

    @if (isLoading)
    {
        <div class="d-flex justify-center mt-16">
            <MudProgressCircular Color=@Color.Primary
                                 Indeterminate=@true />
        </div>
    }
    else
    {
        @* Section 1: Last Opened *@
        @if (lastOpenedBoards.Any())
        {
            <MudText Typo=@Typo.h5
                     Class="mb-4 fw-bold">
                Last Opened
            </MudText>

            <MudGrid Class="mb-8">

                @foreach (var board in lastOpenedBoards)
                {
                    <MudItem xs="12"
                             sm="6"
                             md="3">

                        <MudCard Elevation="3"
                                 Class="cursor-pointer hover-effect mud-theme-primary lighten-5"
                                 @onclick=@(() => HandleBoardClick(board.Id))>

                            <MudCardContent>
                                <MudText Typo=@Typo.h6>
                                    @board.Title
                                </MudText>
                                <MudText Typo=@Typo.caption>
                                    Last opened: @board.LastTimeOpenned.ToShortDateString()
                                </MudText>
                            </MudCardContent>

                        </MudCard>

                    </MudItem>
                }
            </MudGrid>
        }

        @* Section 2: Your Boards *@
        <MudText Typo=@Typo.h5
                 Class="mb-4 fw-bold">
            Your Boards
        </MudText>

        @if (!allBoards.Any())
        {
            <MudAlert Severity=@Severity.Info
                      Variant=@Variant.Outlined>
                You don't have any boards yet.
            </MudAlert>
        }
        else
        {
            <MudGrid>
                @foreach (var board in allBoards)
                {
                    <MudItem xs="12" sm="6" md="4">
                        <MudCard Elevation="2"
                                 Class="height-100 cursor-pointer hover-effect"
                                 @onclick="@(() => HandleBoardClick(board.Id))">

                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.h6">@board.Title</MudText>
                                </CardHeaderContent>

                                <CardHeaderActions>
                                    <span @onclick:stopPropagation="true">

                                        <MudMenu Icon="@Icons.Material.Filled.MoreVert"
                                                 AnchorOrigin="Origin.BottomRight"
                                                 TransformOrigin="Origin.TopRight">

                                            <MudMenuItem Icon="@Icons.Material.Filled.Archive"
                                                         OnClick="@(() => ArchiveBoard(board.Id))">
                                                Archive
                                            </MudMenuItem>

                                            <MudMenuItem Icon="@Icons.Material.Filled.Delete"
                                                         IconColor="Color.Error"
                                                         OnClick="@(() => DeleteBoard(board.Id))">
                                                Delete
                                            </MudMenuItem>
                                        </MudMenu>

                                    </span>
                                </CardHeaderActions>
                            </MudCardHeader>

                            <MudCardContent Class="pb-4">
                                <MudText Typo="Typo.body2" Class="text-secondary">
                                    @board.Description
                                </MudText>
                            </MudCardContent>

                        </MudCard>
                    </MudItem>
                }
            </MudGrid>
        }

        <div class="d-flex justify-end mt-8">

            <MudFab Color=@Color.Secondary
                    StartIcon=@Icons.Material.Filled.Add
                    Label="Create New Board"
                    OnClick=@HandleCreateBoard />

        </div>
    }

</MudContainer>